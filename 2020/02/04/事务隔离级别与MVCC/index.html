<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>事务隔离级别与MVCC | YolkPie</title><meta name="description" content="事务隔离级别与MVCC"><meta name="keywords" content="MVCC,事务隔离"><meta name="author" content="YolkPie"><meta name="copyright" content="YolkPie"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://yolkpie.github.io/2020/02/04/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8EMVCC/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="事务隔离级别与MVCC"><meta property="og:url" content="https://yolkpie.github.io/2020/02/04/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8EMVCC/"><meta property="og:site_name" content="YolkPie"><meta property="og:description" content="事务隔离级别与MVCC"><meta property="og:image" content="https://img12.360buyimg.com/imagetools/jfs/t1/97712/17/11537/68692/5e392e2dE97e61106/0772c1f946454b31.png"><meta property="article:published_time" content="2020-02-04T08:39:35.000Z"><meta property="article:modified_time" content="2020-11-03T07:37:38.489Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="模块机制" href="https://yolkpie.github.io/2020/02/04/%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6/"><link rel="next" title="mysql 索引" href="https://yolkpie.github.io/2020/02/04/mysql-%E7%B4%A2%E5%BC%95/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://at.alicdn.com/t/font_1638514_cadwssqh3zv.css"><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">18</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 相关链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我们</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#null"><span class="toc-number">1.</span> <span class="toc-text">悲观并发控制（Pessimistic&amp;nbsp; Concurrency Control）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">1.1.</span> <span class="toc-text">Innodb中的隐藏列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.2.</span> <span class="toc-text">下面分别以select、delete、 insert、 update语句来说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.3.</span> <span class="toc-text">1. 初始数据行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.4.</span> <span class="toc-text">2.事务1更改该行的各字段的值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.5.</span> <span class="toc-text">3.事务2修改该行的值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">1.1.6.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">1.2.</span> <span class="toc-text">SERIALIZABLE则会对所有读取的行都加锁；</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">1.3.</span> <span class="toc-text">MVCC优缺点</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://img12.360buyimg.com/imagetools/jfs/t1/101636/29/11738/67380/5e392e5cE0c714f8e/ee15bc00dbb1495f.png)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">YolkPie</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 相关链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我们</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">事务隔离级别与MVCC</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-02-04 16:39:35"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-02-04</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-11-03 15:37:38"><i class="fas fa-history fa-fw"></i> 更新于 2020-11-03</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">3.3k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 10 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2020/02/04/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8EMVCC/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><body><a name="2598"></a><div><a name="2598"><span></span></a><div><a name="2598"><div><span style="font-size: 14pt;">MySql常见的几种存储引擎及其特点：</span></div><div><font style="font-size: 14pt;"><br></font></div><div><span style="font-family: Arial; font-variant: normal; font-weight: bold; color: rgb(250, 122, 0); font-size: 14pt;">MyISAM</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">独立于操作系统的，这说明可以轻松地将其从Windows服务器移植到Linux服务器；</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">无法处理事务</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">MyISAM存储引擎特别适合在以下几种情况下使用：<a id="more"></a></span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">1.选择密集型的表。MyISAM存储引擎在筛选大量数据时非常迅速，这是它最突出的优点。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">2.插入密集型的表。MyISAM的并发插入特性允许同时选择和插入数据。例如：MyISAM存储引擎很适合管理邮件或Web服务器日志数据</span></div></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><div><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(250, 122, 0); font-family: Arial; font-weight: bold;">InnoDB</span></span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">健壮的事务型存储引擎</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">在以下场合下，使用InnoDB是最理想的选择：</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">1.更新密集的表。InnoDB存储引擎特别适合处理多重并发的更新请求。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">2.事务。InnoDB存储引擎是支持事务的标准MySQL存储引擎。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">3.自动灾难恢复。与其它存储引擎不同，InnoDB表能够自动从灾难中恢复。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">4.外键约束。MySQL支持外键的存储引擎只有InnoDB。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;">5.支持自动增加列AUTO_INCREMENT属性。</span></div></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">一般来说，如果需要事务支持，并且有较高的并发读取频率，InnoDB是不错的选择。</span></div></div><div><span style="font-size: 14pt;"><span style="color: rgb(250, 122, 0); font-family: Arial; font-size: 14pt; font-weight: bold;">MEMORY&nbsp;</span></span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">存储介质是系统内存</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">一般在以下几种情况下使用Memory存储引擎：</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">1.目标数据较小，而且被非常频繁地访问。在内存中存放数据，所以会造成内存的使用，可以通过参数max_heap_table_size控制Memory表的大小，设置此参数，就可以限制Memory表的最大大小。</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">2.如果数据是临时的，而且要求必须立即可用，那么就可以存放在内存表中。</span></div><div style="font-size: 14px;letter-spacing: normal;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 1;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 255, 255);margin-top: 1em;margin-bottom: 1em;-en-paragraph:true;"><span style="font-size: 14px; letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">3.存储在Memory表中的数据如果突然丢失，不会对应用服务产生实质的负面影响。</span></div><div><span style="font-size: 14pt;"><span style="color: rgb(250, 122, 0); font-family: Arial; font-size: 14pt; font-weight: bold;">ARCHIVE</span></span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">Archive是归档的意思，在归档之后很多的高级功能就不再支持了，仅仅支持最基本的插入和查询两种功能。</span></div><div><span style="font-size: 14px; color: rgb(54, 46, 43); font-family: Arial; font-variant: normal;-en-paragraph:true;">Archive拥有很好的压缩机制，它使用zlib压缩库，在记录被请求时会实时压缩，所以它经常被用来当做仓库使用。</span></div><div><br></div><div><br></div><div><br></div><div><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(227, 0, 0); font-weight: bold;">一、 事务隔离级别</span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(250, 122, 0); font-weight: bold;">事务</span></span></div><div><span style="font-size: 14pt;">一系列对数据访问与更新的操作 所组成的程序执行单元；</span></div><div><font style="font-size: 14pt;"><br></font></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;"><span style="font-size: 14pt; font-weight: bold; color: rgb(250, 122, 0);">事务特性</span>：ACID</span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">原子性</span><span style="font-size: 12pt;">（atomicity&nbsp;&nbsp;</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: nowrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 12pt; color: rgb(51, 51, 51); font-family: arial; font-variant-caps: normal; font-variant-ligatures: normal;">[ˌætəˈmɪsɪti]</span><span style="font-size: 12pt;">）</span></font></div><div><span style="font-size: 12pt;">一个事务必须被视为一个不可分割的的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚；</span></div><div><br></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">一致性</span><span style="font-size: 12pt;">（consistency&nbsp;&nbsp;</span><span style="white-space: nowrap; font-size: 12pt; color: rgb(51, 51, 51); font-family: arial;">[kənˈsɪstənsi]</span><span style="font-size: 12pt;">）</span></font></div><div><span style="font-size: 12pt;">数据库总是从一个一致性的状态转换成另外一个一致性状态；</span></div><div><span style="font-size: 12pt;">不一致状态：比如 数据库系统在运行中发生故障，有些事务尚未完成就被迫中断，对数据库的修改只有一部分写入物理数据库，这时数据库就是处于一种不一致的状态；</span></div><div><span style="font-size: 12pt;">所以说，事务是一致性的单位，如果事务中某个动作失败了，系统可以自动撤销事务，返回初始化的状态。</span></div><div><font style="font-size: 12pt;"><br></font></div><div><span style="font-size: 12pt; font-weight: bold;">隔离性</span><span style="font-size: 12pt;">（isolation&nbsp;&nbsp;</span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: nowrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: arial; font-variant-caps: normal; font-variant-ligatures: normal;">[ˌaɪsəˈleʃən]</span><span style="font-size: 12pt;">）</span><span style="font-size: 12pt; font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div><div><span style="font-size: 12pt;">一个事务所做的修改在最终提交前，对其它事务是不可见的；</span></div><div><br></div><div><span style="font-size: 12pt; font-weight: bold;">持久性</span><span style="font-size: 12pt;">（durability&nbsp;&nbsp;</span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: nowrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: arial; font-variant-caps: normal; font-variant-ligatures: normal;">[ˌdjʊrəˈbɪlətɪ]</span><span style="font-size: 12pt;">）</span></div><div><span style="font-size: 12pt;">事务一旦提交，其所做的修改就会永久保存到数据库中。</span></div><div><font style="font-size: 14pt;"><br></font></div><div><span style="font-size: 14pt; font-weight: bold;"><span style="font-size: 14pt; font-weight: bold; color: rgb(250, 122, 0);">隔离级别</span>：</span></div><div><span style="font-size: 12pt;">标准SQL规范中定义了4种隔离级别，不同的隔离级别对事务的处理不同；</span></div><div><br></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">READ UNCOMMITED（未提交读）</span></span></div><div><span style="font-size: 12pt;">事务中的修改，即使没有提交，对其它事务也都是可见的。</span></div><div><span style="font-size: 12pt;">事务可以读取未提交的数据，也被称为脏读。</span></div><div><span style="font-size: 12pt;">从性能上讲，不会比其它级别好太多，却缺乏其它级别的好处，实际应用中很少使用，如Oracle就不支持该级别。</span></div><div><br></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">READ COMMITED（提交读）</span></span></div><div><span style="font-size: 12pt;">大多数的数据库系统默认级别都是该级别（MySql是REPEATABLE READ）；</span></div><div><span style="font-size: 12pt;">只允许获取已经提交的数据。</span></div><div><br></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">REPEATABLE READ（可重复读）</span></span></div><div><span style="font-size: 12pt;">保证在事务处理过程中，多次读取同一个数据时，其值都和事务开始时刻是一致的。</span></div><div><span style="font-size: 16px;">可能出现幻读：如&nbsp;</span> <span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。</span></div><div><br></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">SERIALIZABLE（串行化）</span></span></div><div><span style="font-size: 12pt;">事务只能一个接一个进行处理，不能并发执行；</span></div><div><span style="font-size: 12pt;">最高的隔离级别；</span></div><table style="border-collapse: collapse; min-width: 100%;table-layout: auto;"><colgroup><col style="width: 468px;"><col style="width: 131px;"><col style="width: 225px;"><col style="width: 166px;"><col style="width: 425px;"></colgroup><tbody style="box-sizing: border-box; outline: 0px; border: 0px; overflow-wrap: break-word;"><tr style="box-sizing: border-box; outline: 0px; background-color: rgb(255, 255, 255); overflow-wrap: break-word; padding: 0px;"><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border: 1px solid rgb(204, 204, 204); width: 468px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 140.833px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: 700; line-height: 22px;">隔离级别</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: 700; line-height: 22px;">脏读</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border: 1px solid rgb(204, 204, 204); width: 225px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 81.6667px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: 700; line-height: 22px;">不可重复读</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border: 1px solid rgb(204, 204, 204); width: 166px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: 700; line-height: 22px;">幻读</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; background-color: rgb(239, 243, 245); border: 1px solid rgb(204, 204, 204); width: 425px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 157.5px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: 700; line-height: 22px;">数据库默认隔离级别</span></div></td></tr><tr style="box-sizing: border-box; outline: 0px; background-color: rgb(255, 255, 255); overflow-wrap: break-word; padding: 0px;"><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 468px; padding: 8px;"><div><span style="font-size: 12pt; color: rgb(79, 79, 79); line-height: 22px;">READ UNCOMMITED（未提交读）</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 225px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 81.6667px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 166px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 425px; padding: 8px;"><div><br></div></td></tr><tr style="box-sizing: border-box; outline: 0px; background-color: rgb(248, 248, 248); overflow-wrap: break-word; padding: 0px;"><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 468px; padding: 8px;"><div><span style="font-size: 12pt; color: rgb(79, 79, 79); line-height: 22px;">READ COMMITED（提交读）</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 225px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 81.6667px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 166px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 425px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 157.5px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; line-height: 22px;">Oracle和</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 157.5px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; line-height: 22px;">SQL</span> <span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 157.5px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; line-height: 22px;">Server</span></div></td></tr><tr style="box-sizing: border-box; outline: 0px; background-color: rgb(255, 255, 255); overflow-wrap: break-word; padding: 0px;"><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 468px; padding: 8px;"><div><span style="font-size: 12pt; color: rgb(79, 79, 79); line-height: 22px;">REPEATABLE READ（可重复读）</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 225px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 81.6667px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">否</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 166px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-weight: normal; line-height: 22px;">是</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; border: 1px solid rgb(204, 204, 204); width: 425px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 157.5px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; line-height: 22px;">MySQL</span></div></td></tr><tr style="box-sizing: border-box; outline: 0px; background-color: rgb(248, 248, 248); overflow-wrap: break-word; padding: 0px;"><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 1px solid rgb(204, 204, 204); width: 468px; padding: 8px;"><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px; text-decoration-color: initial; text-decoration-style: initial;">SERIALIZABLE（串行化）</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px; text-decoration-color: initial; text-decoration-style: initial;">否</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 1px solid rgb(204, 204, 204); width: 225px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 81.6667px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px; text-decoration-color: initial; text-decoration-style: initial;">否</span></div></td><td style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; text-align: left; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; border: 1px solid rgb(204, 204, 204); width: 166px; padding: 8px;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; width: 55px; min-height: 10px; font-size: 14px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22px; text-decoration-color: initial; text-decoration-style: initial;">否</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 425px; padding: 8px;"><div><br></div></td></tr></tbody></table><div><br></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(250, 122, 0); font-weight: bold;">事务隔离级别相关的命令</span></span></span></div><div><br></div><div><span style="font-size: 12pt;">查询隔离级别</span></div><div><span style="font-size: 12pt;">-- select @@tx_isolation;</span></div><div><br></div><div><span style="font-size: 12pt;">设置隔离级别</span></div><div><span style="font-size: 12pt;">-- set global transaction isolation level 级别字符串; &nbsp;</span></div><div><br></div><div><span style="font-size: 16pt;"><span style="font-size: 16pt; color: rgb(255, 0, 0); font-weight: bold;">二、MVCC</span></span></div><div><br></div><div><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">引入了并发事务之后，如果不对事务的执行进行控制就会出现各种各样的问题，常见的并发控制机制主要有三种：</span></div><div><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">悲</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">观并发控制、</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">乐</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">观并发控制、多版本并发控制；</span></div><h2 style="margin: 1em 0px 0.6em; text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(250, 122, 0); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.2em;">悲观并发控制</span></span><span style="font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.2em;">（Pessimistic&nbsp;</span></span> <span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.2em;">Concurrency Control</span><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.2em;">）</span></span></h2><div><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">悲观并发控制其实是最常见的并发控制机制，也就是锁；（后续“锁”专题分享，此处不赘述）</span></div><div><br></div><div><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(250, 122, 0); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.2em;">乐观并发控制</span></span><span style="font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.2em;">（Optimistic&nbsp;</span></span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">Concurrency Control</span><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.2em;">）</span></div><div><br></div><div><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">乐观并发控制也叫乐观锁，但是它并不是真正的锁，基于时间戳的协议</span><span style="font-size: 17px; letter-spacing: 0.1px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif;">能够保证所有冲突的读写操作都能按照时间戳的大小串行执行，在执行对应的操作时不需要关注其他的事务只需要关心数据项对应时间戳的值就可以了；</span></div><div><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">（后续</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">“锁”</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">专题分享，此处不赘述）</span></div><div><br></div><div><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(250, 122, 0); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.2em;">多版本并发控制</span></span></span><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.2em;">（MultiVersion&nbsp;</span><span style="font-size: 17px; letter-spacing: 0.1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(58, 65, 69); font-family: &quot;Hiragino Sans GB&quot;, &quot;Heiti SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif, Merriweather, serif; font-variant-caps: normal; font-variant-ligatures: normal;">Concurrency Control, MVCC</span><span style="text-rendering: geometricPrecision; letter-spacing: -1px; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; color: rgb(46, 46, 46); font-family: &quot;Open Sans&quot;, sans-serif; font-feature-settings: 'dlig' 1, 'liga' 1, 'lnum' 1, 'kern' 1; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.2em;">）</span></div><div><br></div><div><span style="font-size: 12pt;">大多数事务型存储引擎实现的都不是简单的行级锁，一般都同时实现了MVCC；</span></div><div><span style="font-size: 12pt;">可以认为MVCC是行级锁的一个变种，但是它在很多情况下避免了加锁操作，因此开销更低；</span>&nbsp;</div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt; font-variant-caps: normal; font-variant-ligatures: normal;">虽然实现机制有所不同,但大都实现了非阻塞的读操作,写操作也只需要锁定必要的行，</span></span><span style="font-size: 12pt;">下面主要介绍InnoDB的实现。</span></div><div><br></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">基本原理：</span></span></div><div><font style="font-size: 11pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">MVCC 的实现,是通过</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">保存数据在某个时间点的快照</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">来实现的</span></font></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">对普通的SELECT不加锁</span>，</span> <span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">即在某个时刻对事</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">务</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">系统打快照记下所有活跃读写事务ID，之后读操作<span style="font-size: 11pt; color: rgb(61, 70, 77); font-family: -apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">根据事务ID与快照中的事务ID进行比较，判断可见性。</span></span></div><div><br></div><h3 style="box-sizing: border-box; margin: 0px 0px 15px; text-rendering: optimizeLegibility; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; text-rendering: optimizeLegibility; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.7;">Innodb中的隐藏列</span></span></h3><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB的内部实现中为每一行数据增加了几个隐藏列用于实现MVCC。</span></div><table style="table-layout: auto;border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 421px;"><col style="width: 920px;"></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 421px; padding: 8px;"><div>列名</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 920px; padding: 8px;"><div>作用</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 421px; padding: 8px;"><div>DB_TRX_ID</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 920px; padding: 8px;"><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">系统版本号</span>，标记了最新更新这条行记录的transaction id，<span style="font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">每处理一个事务，其值自动+1</span></span>。</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 421px; padding: 8px;"><div>DB_ROLL_PTR</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 920px; padding: 8px;"><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">指向当前记录项的rollback segment的undo log记录，<span style="font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">找之前版本的数据就是通过这个指针</span></span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 421px; padding: 8px;"><div><span style="font-size: 11pt;">DB_ROW_ID</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 920px; padding: 8px;"><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">隐含ID，当由innodb自动产生聚集索引时，聚集索引包括这个DB_ROW_ID的值，否则聚集索引中不包括这个值.这个用于索引当中；</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(61, 70, 77); font-variant-caps: normal; font-variant-ligatures: normal;">如果表没有定义主键那么DATA_ROW_ID作为主键列，否则行结构中没有DATA_ROW_ID列。</span></span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 421px; padding: 8px;"><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">DELETE BIT</span></span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 920px; padding: 8px;"><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">标识该记录是否被删除</span></span></div></td></tr></tbody></table><div><br></div><div><br></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; font-family: Verdana;">名词延伸：</span></span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><br></div><table style="table-layout: auto;border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 293px;"><col style="width: 1020px;"></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="font-size: 14px;">名词</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="font-size: 14px;">解释</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">undo log</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">用于存放数据修改被修改前的值</span> <span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，可以用来在事务失败时进行rollback；</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">redo</span><span style="font-size: 11pt;">&nbsp;l</span><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">og</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">记录某数据块被修改后的值，可以用来恢复未写入data file的已成功事务更新的数据</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(34, 34, 34); font-family: Verdana; font-variant-caps: normal; font-variant-ligatures: normal;">rollback segment</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(34, 34, 34); font-family: Verdana; font-variant-caps: normal; font-variant-ligatures: normal;">在Innodb中，undo log被划分为多个段，具体某行的undo log就保存在某个段中，称为回滚段</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">data file</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">数据库文件</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">db buffer</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">数据库缓存</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">log buffer</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">日志缓存</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 293px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">log file</span></div></td><td style="border: 1px solid rgb(204, 204, 204); width: 1020px; padding: 8px;"><div><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">磁盘日志文件</span></div></td></tr></tbody></table><div><br></div></div><div style="margin-top: 1em; margin-bottom: 1em; text-align: start;"><span style="-en-paragraph:true;">在不考虑redo log 的情况下利用undo log工作的简化过程为：</span></div><table style="table-layout: auto;border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 132px;"><col style="width: 471px;"></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>序号</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>动作</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>1</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>开始事务</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>2</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>记录数据行数据快照到undo log</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>3</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>更新数据</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>4</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>将undo log写到磁盘</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>5</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>将数据写到磁盘</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 132px; padding: 8px;"><div>6</div></td><td style="border: 1px solid rgb(204, 204, 204); width: 471px; padding: 8px;"><div>提交事务</div></td></tr></tbody></table><blockquote style="text-align: start;"><div>1）为了保证数据的持久性，数据要在事务提交之前持久化</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">2）undo log的持久化必须在在数据持久化之前，这样才能保证系统崩溃时，可以用undo log来回滚事务</span></div></blockquote><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 10px 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></h4><h4 style="margin: 10px 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">下面分别以select、delete、 insert、 update语句来说明</span></h4><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">SELECT</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Innodb检查每行数据，确保他们符合两个标准：</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">1、InnoDB只查找版本早于当前事务版本的数据行(也就是数据行的版本必须小于等于事务的版本)，这确保当前事务读取的行都是事务之前已经存在的，或者是由当前事务创建或修改的行</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">2、行的删除操作的版本一定是未定义的或者大于当前事务的版本号，确定了当前事务开始之前，行没有</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">被删除</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">符合了以上两点则返回查询结果。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">INSERT</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB为每个新增行 记录当前系统版本号作为行版本号。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">DELETE</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB为每个删除行 记录当前系统版本号作为行的删除</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">标识</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">UPDATE</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 14px;"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">InnoDB插入一行新记录，保存当前系统版本号作为行版本号，同时保存当前系统版本号到原来的行作为行删除标识。</span></span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">下面演示下事务对某行记录的更新过程：</span></div><h4 style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">1. 初始数据行</span></h4><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;"><img src= "/img/loading.gif" data-src="../事务隔离级别与MVCC/44474267_1.gif" type="image/gif" data-filename="44474267_1.gif"></span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">F1～F6是某行列的名字，1～6是其对应的数据。后面三个隐含字段分别对应该行的事务号和回滚指针，假如这条数据是刚INSERT的，可以认为ID为1，其他两个字段为空。</span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">2.事务1更改该行的各字段的值</span></h4><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;"><img src= "/img/loading.gif" data-src="../事务隔离级别与MVCC/44474267_2.gif" type="image/gif" data-filename="44474267_2.gif"></span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">当事务1更改该行的值时，会进行如下操作：</span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="padding: 0px; margin: 0px; list-style: none;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">用排他锁锁定该行</span></div><div style="padding: 0px; margin: 0px; list-style: none;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">记录redo log</span></div><div style="padding: 0px; margin: 0px; list-style: none;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">把该行修改前的值Copy到undo log，即上图中下面的行</span></div><div style="padding: 0px; margin: 0px; list-style: none;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">修改当前行的值，填写事务编号，使回滚指针指向undo log中的修改前的行</span></div><div style="padding: 0px; margin: 0px; list-style: none;"></div></div><h4 style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: 微软雅黑, 宋体, 黑体, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">3.事务2修改该行的值</span></h4><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;"><img src= "/img/loading.gif" data-src="../事务隔离级别与MVCC/44474267_3.gif" type="image/gif" data-filename="44474267_3.gif"></span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">与事务1相同，此时undo log，中有有两行记录，并且通过回滚指针连在一起。</span></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">因此，如果undo log一直不删除，则会通过当前记录的回滚指针回溯到该行创建时的初始内容，所幸的时在<span style="font-size: 14px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Innodb中存在purge线程，它会查询那些比现在最老的活动事务还早的undo log，并删除它们，从而保证undo log文件不至于无限增长。</span></span></div><h4 style="margin: 10px 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></h4><div style="text-align: start;"><font style="font-size: 14pt;"><br></font></div><div style="text-align: start;"><span style="font-size: 14pt; font-weight: bold;">事务提交</span></div><div style="text-align: start;"><font style="font-size: 14pt;"><br></font></div><div style="text-align: start;"><span style="font-size: 12pt;">当事务正常提交时Innodb只需要更改事务状态为COMMIT即可，不需做其他额外的工作；</span></div><div style="text-align: start;"><span style="font-size: 12pt;">而Rollback则稍微复杂点，需要根据当前回滚指针从undo log中找出事务修改前的版本，并恢复。如果事务影响的行非常多，回滚则可能会变的效率不高，根据经验值：事务行数在1000～10000之间，Innodb效率还是非常高的。</span></div><div style="text-align: start;"><font style="font-size: 14pt;"><br></font></div><div style="text-align: start;"></div><div style="text-align: start;"><span style="font-size: 14pt; font-weight: bold;">适用范围</span></div><div style="text-align: start;"><font style="font-size: 14pt;"><br></font></div><div style="text-align: start;"><span style="font-size: 16px;">MVCC只在</span><span style="font-size: 12pt;">REPEATABLE READ（可重复读）和</span><span style="font-size: 12pt;">READ COMMITED（提交读）两个隔离级别下工作。</span></div><div style="text-align: start;"><span style="font-size: 12pt;">因为：</span></div><div style="text-align: start;"><span style="font-size: 12pt;">READ UNCOMMITED总是读取最新的数据行，而不是符合当前事务版本的数据行；</span></div><h3 style="box-sizing: border-box; margin: 0px 0px 15px; font-size: 22px; text-rendering: optimizeLegibility; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 12pt; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1.7;">SERIALIZABLE则会对所有读取的行都加锁；</span></h3><div><br></div><h3 style="box-sizing: border-box; margin: 0px 0px 15px; text-rendering: optimizeLegibility; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; text-rendering: optimizeLegibility; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.7;">MVCC优缺点</span></span></h3><div style="box-sizing: border-box; margin: 0px 0px 25px; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); word-break: break-word !important;"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; word-break: break-word !important; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">MVCC在大多数情况下代替了行锁，实现了对读的非阻塞，读不加锁，读写不冲突。</span></div><div style="box-sizing: border-box; margin: 0px 0px 25px; font-size: 16px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); word-break: break-word !important;"><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; word-break: break-word !important; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">缺点是每行记录都需要额外的存储空间，需要做更多的行维护和检查工作。</span></div><div style="margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="margin: 0px; padding: 0px;"></div><div style="margin: 0px; padding: 0px;"><font style="font-size: 14pt;"><br></font></div><div style="margin: 0px; padding: 0px;"><span style="font-size: 14pt; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">思考：</span></div><div style="margin: 0px; padding: 0px;"></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; overflow-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal;">Innodb的实现方式是：</span></div></div><div style="font-size: 14px; padding: 0px; margin: 0px; list-style: none;"><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; overflow-wrap: break-word;"><span style="background-color: rgb(255, 255, 255); font-size: 14px;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">事务以排他锁的形式修改原始数据</span></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; overflow-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">把修改前的数据存放于undo log，通过回滚指针与主数据关联</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; overflow-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">修改成功（commit）啥都不做，失败则恢复undo log中的数据（rollback）</span></div><div><br></div></div><div style="font-size: 14px; margin: 0px; padding: 0px;"><span style="background-color: rgb(255, 255, 255); font-size: 14px;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">当修改数据时是否要排他锁定，如果锁定了还算不算是MVCC？&nbsp;</span></span></div><div style="font-size: 14px; margin: 0px; padding: 0px;"><br></div><div style="font-size: 14px; margin: 0px; padding: 0px;"><span style="font-size: 14px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">Innodb的实现真算不上MVCC，因为并没有实现核心的多版本共存，undo log中的内容只是串行化的结果，记录了多个事务的过程，不属于多版本共存。但理想的MVCC是难以实现的，当事务仅修改一行记录使用理想的MVCC模式是没有问题的，可以通过比较版本号进行回滚；但当事务影响到多行数据时，理想的MVCC据无能为力了。</span></div></div><div style="margin: 0px; padding: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(47, 47, 47); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal;">比如，如果Transaciton1执行理想的MVCC，修改Row1成功，而修改Row2失败，此时需要回滚Row1，但因为Row1没有被锁定，其数据可能又被Transaction2所修改，如果此时回滚Row1的内容，则会破坏Transaction2的修改结果，导致Transaction2违反ACID。</span></div><div><br></div><div><br></div><div><br></div><div><span style="font-size: 12pt;">参考：</span></div><div><span style="font-size: 12pt;">《高性能MySql》</span></div></a><div><a name="2598"><span style="font-size: 12pt;"></span></a><a href="https://draveness.me/database-concurrency-control" target="_blank" rel="noopener" style="font-size: 12pt;">https://draveness.me/database-concurrency-control</a></div><div><span style="font-size: 12pt;"><a href="http://www.cnblogs.com/chenpingzhao/p/5065316.html" target="_blank" rel="noopener" style="font-size: 12pt;">http://www.cnblogs.com/chenpingzhao/p/5065316.html</a></span></div><div><a href="https://www.jianshu.com/p/a3d49f7507ff" target="_blank" rel="noopener">https://www.jianshu.com/p/a3d49f7507ff</a></div><div><a href="https://blog.csdn.net/chen77716/article/details/6742128" target="_blank" rel="noopener">https://blog.csdn.net/chen77716/article/details/6742128</a></div><div><a href="http://www.360doc.com/content/14/0821/09/12904276_403505950.shtml" target="_blank" rel="noopener">http://www.360doc.com/content/14/0821/09/12904276_403505950.shtml</a></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><font style="font-size: 12pt;"><br></font></div></div><div><br></div></div></body>
<script>window.onload=function(){setTimeout(function(){document.querySelector('.sidebar-inner').style.display = 'none';}, 900)}</script></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">YolkPie</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yolkpie.github.io/2020/02/04/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8EMVCC/">https://yolkpie.github.io/2020/02/04/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8EMVCC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yolkpie.github.io" target="_blank">YolkPie</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MVCC/">MVCC</a><a class="post-meta__tags" href="/tags/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/">事务隔离</a></div><div class="post_share"><div class="social-share" data-image="https://img11.360buyimg.com/imagetools/jfs/t1/131570/8/14659/19885/5f9fc360E691d4f87/ceb97d78c165ee18.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/02/04/%E6%A8%A1%E5%9D%97%E6%9C%BA%E5%88%B6/"><img class="prev-cover" data-src="https://img11.360buyimg.com/imagetools/jfs/t1/102216/12/11607/84329/5e392fa6Ed3776529/7876798328a0b515.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">模块机制</div></div></a></div><div class="next-post pull-right"><a href="/2020/02/04/mysql-%E7%B4%A2%E5%BC%95/"><img class="next-cover" data-src="https://img14.360buyimg.com/imagetools/jfs/t1/99941/31/11809/29824/5e392d51Efbe7ca53/acc64d7b5744c591.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">mysql 索引</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '6e1bb19099a60d063402',
  clientSecret: '6fefeea17c4f73c838216b0aab539d37c7bbcdad',
  repo: 'yolkpie.github.io',
  owner: 'YolkPie',
  admin: ['yujihu'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: true,
  pagerDirection: 'last',
  createIssueManually: true,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By YolkPie</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><div style="display:none"><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279214088&web_id=1279214088"></script></div></body></html>